---
categories: [Spotfire]
---
<html>

<head>
  <title>Look Up separate Table</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307881 (en-US, DDL); Windows/10.0.0 (Win64);" />
  <style>
    body,
    td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>

<body>
  <a name="426"/>

<div>
<span><div><div><span style="font-size: 12pt; font-weight: bold;">Problem:</span></div><div><span style="font-size: 12pt; font-weight: bold;">   </span> <span style="font-size: 8pt;">Look up drill down information from a table with no relationships to another.  I often</span> <span style="font-size: 10.6667px;">aggregated data such as survey or quality that will have multiple instances each day, each instances has multiple questions. Using transformations I can get the drilled down data to match with a daily aggregate but having the drill down from the Drilled Up information proved challenging. </span><span style="font-size: 8pt;"> </span></div><div><span style="font-size: 8pt;"><br/></span></div><div><span style="font-size: 12pt; font-weight: bold;">Solutions:</span></div><div><b><span style="font-size: 12pt;">   </span></b> <span style="font-size: 8pt;">Use a python script to store a list of uniqueconcatennated ID's in a document property when items are marked. Then use the list of values to use a R script merge to produce a table with the drill down for the list of values. </span><br/></div><div><span style="font-size: 8pt;"><br/></span></div><div><img src="/images/LookUpList_1.gif" type="image/gif" data-filename="LookUpList_1.gif" width="610"/></div><div><br/></div><div><br/></div><div>Filter Counter<br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>output &lt;- input<br/></div></div><div><br/></div><div>Grab Values From Table to Document Property</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from System.Collections.Generic import List</div><div>from Spotfire.Dxp.Data import *</div><div>from Spotfire.Dxp.Application.Visuals import VisualContent</div><div>from Spotfire.Dxp.Data import RowSelection</div><div>from Spotfire.Dxp.Data import DataValueCursor</div><div>from Spotfire.Dxp.Data import DataManager</div><div>from Spotfire.Dxp.Data import IndexSet</div><div><br/></div><div>dataTable = Document.ActiveDataTableReference</div><div>rows = Document.ActiveFilteringSelectionReference.GetSelection(</div><div>    dataTable).AsIndexSet()</div><div><br/></div><div>vc = vis.As[VisualContent]()</div><div>dataTable = vc.Data.DataTableReference</div><div><br/></div><div>for filter in Document.FilteringSchemes[Document.ActiveFilteringSelectionReference]:</div><div>    filteredRows = filter.FilteredRows</div><div>    marking = vc.Data.MarkingReference</div><div><br/></div><div>marking.SetSelection(RowSelection(rows), dataTable)</div><div><br/></div><div># Create a cursor for the table column to get the values from.</div><div># Add a reference to the data table in the script.</div><div>dataTable = Document.Data.Tables[&quot;AllPossible&quot;]</div><div>cursor = DataValueCursor.CreateFormatted(dataTable.Columns[&quot;SurveyID&quot;])</div><div><br/></div><div># Retrieve the marking selection</div><div>markings = Document.ActiveMarkingSelectionReference.GetSelection(dataTable)</div><div><br/></div><div># Create a List object to store the retrieved data marking selection</div><div>markedata = List[str]()</div><div><br/></div><div># Iterate through the data table rows to retrieve the marked rows</div><div>for row in dataTable.GetRows(markings.AsIndexSet(), cursor):</div><div>    # rowIndex = row.Index ##un-comment if you want to fetch the row index into some defined condition</div><div>    value = cursor.CurrentValue</div><div>    if value &lt;&gt; str.Empty and value &lt;&gt; &quot;(Empty)&quot;:</div><div>        markedata.Add(value)</div><div><br/></div><div># Get only unique values</div><div>valData = List[str](set(markedata))</div><div><br/></div><div># Store in a document property</div><div>yourVariableName = ', '.join(valData)</div><div>Document.Properties[&quot;ListofValues&quot;] = yourVariableName</div><div># print(yourVariableName)</div><div><br/></div><div>marking = Application.GetService[DataManager]().Markings[markingName]</div><div>selectRows = IndexSet(dataTable.RowCount, False)</div><div>marking.SetSelection(RowSelection(selectRows), dataTable)</div><div><br/></div></div><div><br/></div><div><span style="font-size: 10pt;">R Script Create New Table</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#SurveyID , SurveyData - Inputs (Document Property, Table)</div><div>#MyData - Output (Table)</div><div>    df &lt;- read.table(text=SurveyID, sep=&quot;,&quot;)</div><div>#Change to Table</div><div>    df &lt;- t(df)</div><div>#Change Column Name to Match Look up Column</div><div>    colnames(df)[1] &lt;- &quot;SurveyID&quot;</div><div>#Load Table</div><div>    df2 &lt;- SurveyData</div><div>#Merge Two DataFrames</div><div>    Mydata&lt;- merge(df,df2)</div></div><div><br/></div><ol><li><div>Set Document Property with Filtered Row Count (I added PersonID to the count to account for people with same number of rows)</div></li></ol><div><span>    </span><span>    </span><span>    </span><img src="/images/ValueLookUp_1.png" type="image/png" data-filename="ValueLookUp_1.png" width="510"/></div><ol start="2"><li><div>Set Input </div></li></ol><div><span>    </span><span>    </span><span>    </span><img src="/images/ValueLookUp_2.png" type="image/png" data-filename="ValueLookUp_2.png" width="515"/></div><ol start="3"><li><div>Set Output </div></li></ol><div><span>    </span><span>    </span><span>    </span><img src="/images/ValueLookUp_3.png" type="image/png" data-filename="ValueLookUp_3.png" width="515"/></div><ol start="4"><li><div>Add Script to Document Property<br/></div></li></ol><div><span>    </span><span>    </span><span>    </span><img src="/images/ValueLookUp_4.png" type="image/png" data-filename="ValueLookUp_4.png" width="514"/></div><ol start="5"><li><div>Add Python Script to Get Values from Table to Document Property</div></li></ol><div><br/></div><div><span>    </span><span>    </span><span>    </span><img src="/images/ValueLookUp_5.png" type="image/png" data-filename="ValueLookUp_5.png" width="512"/></div><ol start="6"><li><div> Register R function for New Table </div></li></ol><div><span>    </span><span>    </span><span>    </span><img src="/images/ValueLookUp_6.png" type="image/png" data-filename="ValueLookUp_6.png" width="514"/></div><div><br/></div><div><br/></div></div></span>
</div></body></html>
